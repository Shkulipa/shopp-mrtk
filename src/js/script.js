let catalog = [
  {
    id: "fairy",
    link: "https://fairy.shopping-market.space/",
    dataCategory: "Игрушки",
    imgWebPrew: "img/prew-fairy.webp",
    imgJpgPrew: "img/prew-fairy.jpg",
    sale: true,
    new: true,
    hit: true,
    discount: true,
    discountValue: "-53%",
    specialOffer: false,
    specialOfferValue: "1 + 1 = 3",
    title: "Летающая фея",
    namedProduct: "Летающая фея",
    dataId: "5kT4Ta",
    count: 1,
    price: 249.0,
    totalPrice: 249.0,
    value: "UAH",
  },
  {
    id: "car-transformet",
    link: "https://kids-toys.shopping-market.space/",
    dataCategory: "Игрушки",
    imgWebPrew: "img/prew-car-transformer.webp",
    imgJpgPrew: "img/prew-car-transformer.jpg",
    sale: true,
    new: true,
    hit: true,
    discount: true,
    discountValue: "-53%",
    specialOffer: false,
    specialOfferValue: "1 + 1 = 3",
    title: "Машинка трансформер на радиоуправлении",
    namedProduct: "Машинка трансформер на радиоуправлении",
    dataId: "gAV4BF",
    count: 1,
    price: 399.0,
    totalPrice: 399.0,
    value: "UAH",
  },
  {
    id: "Nabor-sveta",
    link: "https://svet.shopping-market.space/",
    dataCategory: "Игрушки",
    imgWebPrew: "img/prew-svet.webp",
    imgJpgPrew: "img/prew-svet.jpg",
    sale: true,
    new: true,
    hit: true,
    discount: true,
    discountValue: "-53%",
    specialOffer: false,
    specialOfferValue: "1 + 1 = 3",
    title: "Набор для рисования светом",
    namedProduct: "Набор для рисования светом",
    dataId: "A2nV4M",
    count: 1,
    price: 199.0,
    totalPrice: 199.0,
    value: "UAH",
  },
  {
    id: "magic-track",
    link: "https://magic-tracks.shopping-market.space",
    dataCategory: "Игрушки",
    imgWebPrew: "img/prew-magic-track.webp",
    imgJpgPrew: "img/prew-magic-track.jpg",
    sale: true,
    new: true,
    hit: true,
    discount: true,
    discountValue: "-53%",
    specialOffer: false,
    specialOfferValue: "1 + 1 = 3",
    title: "Светящееся машинки с трассой",
    namedProduct: "Светящееся машинки с трассой",
    dataId: "5kT4Tb",
    count: 1,
    price: 349.0,
    totalPrice: 349.0,
    value: "UAH",
  },
  {
    id: "ice-scrapper",
    link: "https://ice-scrapper.shopping-market.space",
    dataCategory: "Автотовары",
    imgWebPrew: "img/prew-ice-scrapper.webp",
    imgJpgPrew: "img/prew-ice-scrapper.jpg",
    sale: true,
    new: true,
    hit: true,
    discount: true,
    discountValue: "-53%",
    specialOffer: false,
    specialOfferValue: "1 + 1 = 3",
    title: "Cкребок для автомобиля",
    namedProduct: "Cкребок для автомобиля",
    dataId: "5kT4Tq",
    count: 1,
    price: 199.0,
    totalPrice: 199.0,
    value: "UAH",
  },

  // {
  //   id: "clothes-shaver",
  //   link: "https://clothes-shaver.shopping-market.space",
  //   dataCategory: "Товары-для-дома",
  //   imgJpgPrew: "img/prew-clothes-shaver.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-35%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Средство для удаления кашлатости",
  //   namedProduct: "Clothes shaver",
  //   dataId: "bF7s4A",
  //   count: 1,
  //   price: 199.0,
  //   totalPrice: 199.0,
  //   value: "UAH",
  // },
  // {
  //   id: "socks",
  //   link: "https://socks.shopping-market.space",
  //   dataCategory: "Женская-одежда",
  //   imgJpgPrew: "img/prew-socks.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-54%",
  //   specialOffer: true,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Силиконовые увлажняющие носочки против трения стопы с супинатором!",
  //   namedProduct: "Silicon socks",
  //   dataId: "YAooUP",
  //   count: 1,
  //   price: 149.0,
  //   totalPrice: 149.0,
  //   value: "UAH",
  // },
  // {
  //   id: "hot-shapers",
  //   link: "https://slimming-belt.shopping-market.space",
  //   dataCategory: "Товары-для-спорта-здоровья-и-красоты",
  //   imgJpgPrew: "img/prew-hot-shapers.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-50%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Hot Shapers - Пояс для похудения и коррекции фигуры",
  //   namedProduct: "hot-shapers",
  //   dataId: "7eW7KS",
  //   count: 1,
  //   price: 199.0,
  //   totalPrice: 199.0,
  //   value: "UAH",
  // },
  // {
  //   id: "Spine",
  //   link: "https://posture-corrector.shopping-market.space",
  //   dataCategory: "Товары-для-спорта-здоровья-и-красоты",
  //   imgJpgPrew: "img/prew-corector-osanki.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-72%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Spine - Магнитный корректор осанки. Быстрое исправление осанки",
  //   namedProduct: "Spine",
  //   dataId: "nBCPzS",
  //   count: 1,
  //   price: 249.0,
  //   totalPrice: 249.0,
  //   value: "UAH",
  // },
  // {
  //   id: "magnetfix",
  //   link: "https://magnet-fix.shopping-market.space",
  //   dataCategory: "Товары-для-спорта-здоровья-и-красоты",
  //   imgJpgPrew: "img/prew-magnet-fix.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-50%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "MagnetFix - Помогает избавиться от вальгусной деформации",
  //   namedProduct: "magnetfix",
  //   dataId: "a7M0K9",
  //   count: 1,
  //   price: 249.0,
  //   totalPrice: 249.0,
  //   value: "UAH",
  // },
  // {
  //   id: "magic-wash",
  //   link: "https://washing-capsules.shopping-market.space",
  //   dataCategory: "Товары-для-дома",
  //   imgJpgPrew: "img/prew-magic-wash.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-54%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Чистящее средство для вашей стиральной машинки!",
  //   namedProduct: "magic-wash",
  //   dataId: "fDSuj3",
  //   count: 1,
  //   price: 360.0,
  //   totalPrice: 360.0,
  //   value: "UAH",
  // },
  // {
  //   id: "sani-sticks",
  //   link: "https://sani-sticks.shopping-market.space",
  //   dataCategory: "Чистящие-средства",
  //   imgJpgPrew: "img/prew-sani-sticks.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-50%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Палочки от засоров. Чистота водопроводных труб от засоров и запахов на целый год!",
  //   namedProduct: "sani-sticks",
  //   dataId: "Rdne7b",
  //   count: 1,
  //   price: 240.0,
  //   totalPrice: 240.0,
  //   value: "UAH",
  // },
  // {
  //   id: "fly-bra",
  //   link: "https://fly-bra.shopping-market.space",
  //   dataCategory: "Женская-одежда",
  //   imgJpgPrew: "img/prew-fly-bra.jpg",
  //   sale: true,
  //   new: false,
  //   hit: false,
  //   discount: true,
  //   discountValue: "-54%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Бюсгальтер-невидимка для идеального декольте",
  //   namedProduct: "fly-bra",
  //   dataId: "GOeC1c",
  //   count: 1,
  //   price: 199.0,
  //   totalPrice: 199.0,
  //   value: "UAH",
  // },
  // {
  //   id: "elaslim",
  //   link: "https://elaslim.shopping-market.space",
  //   dataCategory: "Женская-одежда",
  //   imgJpgPrew: "img/prew-elaslim.jpg",
  //   sale: true,
  //   new: false,
  //   hit: false,
  //   discount: true,
  //   discountValue: "-54%",
  //   specialOffer: true,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Революционные нервущиеся колготки!",
  //   namedProduct: "elaslim",
  //   dataId: "N72uEg",
  //   count: 1,
  //   price: 149.0,
  //   totalPrice: 149.0,
  //   value: "UAH",
  // },
  // {
  //   id: "easy-mop",
  //   link: "https://easy-mop.shopping-market.space",
  //   dataCategory: "Товары-для-дома",
  //   imgJpgPrew: "img/prew-easy-mop.jpg",
  //   sale: true,
  //   new: false,
  //   hit: false,
  //   discount: true,
  //   discountValue: "-53%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Easy Mop – простое решение всех проблем с уборкой пола",
  //   namedProduct: "easy-mop",
  //   dataId: "0Y9wxd",
  //   count: 1,
  //   price: 299.0,
  //   totalPrice: 299.0,
  //   value: "UAH",
  // },
  // {
  //   id: "wild-tornado",
  //   link: "https://wild-tornado.shopping-market.space",
  //   dataCategory: "Чистящие-средства",
  //   imgJpgPrew: "img/prew-wild-tornado.jpg",
  //   sale: true,
  //   new: false,
  //   hit: false,
  //   discount: true,
  //   discountValue: "-53%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Универсальное чистящее средство. Больше никаких засоров!",
  //   namedProduct: "wild-tornado",
  //   dataId: "kMkddn",
  //   count: 1,
  //   price: 249.0,
  //   totalPrice: 249.0,
  //   value: "UAH",
  // },
  // {
  //   id: "handy-heater",
  //   link: "https://handy-heater.shopping-market.space",
  //   dataCategory: "Товары-для-дома",
  //   imgJpgPrew: "img/prew-handy-heater.jpg",
  //   sale: true,
  //   new: false,
  //   hit: false,
  //   discount: true,
  //   discountValue: "-54%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Мощный портативный обогреватель",
  //   namedProduct: "handy-heater",
  //   dataId: "0LKsKL",
  //   count: 1,
  //   price: 349.0,
  //   totalPrice: 349.0,
  //   value: "UAH",
  // },
  // {
  //   id: "led-lampa",
  //   link: "https://led-lampa.shopping-market.space",
  //   dataCategory: "Товары-для-спорта-здоровья-и-красоты",
  //   imgJpgPrew: "img/prew-led-lampa.jpg",
  //   sale: true,
  //   new: true,
  //   hit: true,
  //   discount: true,
  //   discountValue: "-50%",
  //   specialOffer: false,
  //   specialOfferValue: "1 + 1 = 3",
  //   title: "Led lampa - Светодиодный светильник для селфи",
  //   namedProduct: "led-lampa",
  //   dataId: "mad2CL",
  //   count: 1,
  //   price: 360.0,
  //   totalPrice: 360.0,
  //   value: "UAH",
  // },
];

// Переобразуем массив "catalog" в Ассоциативный массив
let catalogAssArr = {};
function catalogAssArrFunction() {
  let catalogAssArr = {};
  catalog.forEach(function (e) {
    catalogAssArr[e.id] = e;
  });
  return catalogAssArr;
}
catalogAssArrFunction();

let outCatalog = '';
for(let key in catalog) {
  outCatalog += `<div  class="catalog__items__item" target="_blank" data-category=${catalog[key].dataCategory}>`;
  outCatalog += `<a href="${catalog[key].link}" target="_blank" class="catalog__items__item__img">`;
  outCatalog +=
    `<picture>
      <source srcset="${catalog[key].imgWebPrew}" type="image/webp">
      <img src="${catalog[key].imgJpgPrew}" alt="img">
    </picture>`;
  outCatalog +=
    `<div class="catalog__items__item__img__tags">` +
    `${
      catalog[key].sale === true
        ? '<div class="catalog__items__item__img__tags__block sale">#Распродажа</div><br />'
        : ''
    }` +
    `${
      catalog[key].new === true
        ? '<div class="catalog__items__item__img__tags__block new">#Новинка</div><br />'
        : ''
    }` +
    `${
      catalog[key].hit === true
        ? '<div class="catalog__items__item__img__tags__block hit">#Хит</div><br />'
        : ''
    }` +
    `${
      catalog[key].discount === true
        ? '<div class="catalog__items__item__img__tags__block discount">' + catalog[key].discountValue + '</div><br />'
        : ''
    }` +
    `${
      catalog[key].specialOffer === true
        ? '<div class="catalog__items__item__img__tags__block special-offer">' + catalog[key].specialOfferValue + '</div><br />'
        : ''
    }</div></a>`; 
    outCatalog +=
    `<div class="catalog__items__item__content">` +
    `<div class="catalog__items__item__content__title">${catalog[key].title}</div>`;
    outCatalog += `<button id="add-to-cart" class="catalog__items__item__content__cart" data-id=${catalog[key].dataId}>` + 
                  `<img id="add-to-cart" src="icons/shopping-cart.svg" alt="img" data-id=${catalog[key].dataId}>` +
                  `<p id="add-to-cart" class="catalog__items__item__content__cart__text" data-id=${catalog[key].dataId}>Добавить в корзину</p></button></div></div>`;
};
document.getElementById('catalog__items').innerHTML = outCatalog;


$(".catalog__items > .catalog__items__item")
  .clone()
  .unwrap()
  .appendTo($(".bestsellers__slider").empty());
$(".bestsellers__slider > .catalog__items__item").each(function () {
  if ($(this).find(".hit").length == 0) {
    $(this).remove();
  }
});
  
$(document).ready(function () {
  /*smooth scroll */
  if (window.matchMedia("(max-width: 565px)").matches) {
    $("a[href^='#']").click(function () {
      var _href = $(this).attr("href");
      $("html, body").animate({
        scrollTop: $(_href).offset().top - 180 + "px",
      });
      return false;
    });
  } else {
    $("a[href^='#']").click(function () {
      var _href = $(this).attr("href");
      $("html, body").animate({ scrollTop: $(_href).offset().top - 80 + "px" });
      return false;
    });
  }

  // slider of catigories
  $(".catigories__slider").slick({
    pauseOnHover: true,
    autoplay: true,
    autoplaySpeed: 1250,
    slidesToShow: 5,
    adaptiveHeight: false,
    initialSlide: 4,
    dots: false,
    prevArrow:
      '<button type="button" class="slick-prev"><img src="icons/arrow-slider.svg"></button>',
    nextArrow:
      '<button type="button" class="slick-next"><img src="icons/arrow-slider.svg"></button>',
    responsive: [
      {
        breakpoint: 767,
        settings: {
          slidesToShow: 4,
          arrows: false,
        },
      },
      {
        breakpoint: 565,
        settings: {
          slidesToShow: 4,
          arrows: false,
        },
      },
    ],
  });

  // slider of intro
  $(".intro__slider").slick({
    pauseOnHover: true,
    autoplay: true,
    autoplaySpeed: 3000,
    slidesToShow: 1,
    adaptiveHeight: false,
    arrows: false,
    dots: true,
    prevArrow:
      '<button type="button" class="slick-prev"><img src="icons/arrow-slider.svg"></button>',
    nextArrow:
      '<button type="button" class="slick-next"><img src="icons/arrow-slider.svg"></button>',
  });

  // slider of bestsellers
  $(".bestsellers__slider").slick({
    pauseOnHover: true,
    autoplay: true,
    autoplaySpeed: 2500,
    slidesToShow: 3,
    adaptiveHeight: false,
    arrows: true,
    dots: false,
    prevArrow:
      '<button type="button" class="slick-prev"><img src="icons/arrow-slider.svg"></button>',
    nextArrow:
      '<button type="button" class="slick-next"><img src="icons/arrow-slider.svg"></button>',
    responsive: [
      {
        breakpoint: 767,
        settings: {
          slidesToShow: 2,
          arrows: false,
          dots: true,
        },
      },
    ],
  });

  
  // Random buyer
  const NamesWomen = [
    "Татьяна",
    "Елена",
    "Ольга",
    "Наталья",
    "Валентина",
    "Мария",
    "Галина",
    "Анна",
    "Анна Кудряшова",
    "Светлана",
    "Людмила",
    "Нина",
    "Екатерина",
    "Надежда",
    "Марина",
    "Юлия",
    "Любовь",
    "Любовь",
    "Лидия Фролова",
    "Александра",
    "Вера",
    "Анастасия",
    "Тамара",
    "Лариса",
    "Наталия",
    "Зинаида",
    "Оксана",
    "Оксана Цветкова",
    "Валерия",
    "Полина",
    "Алена",
    "Алина",
  ];

  const NamesMans = [
    "Александр",
    "Алексей",
    "Анатолий",
    "Андрей",
    "Андрей Пономарёв",
    "Антон",
    "Богдан",
    "Вадим",
    "Виталий",
    "Геннадий",
    "Вячеслав",
    "Георгий",
    "Глеб",
    "Давид",
    "Денис",
    "Илья",
    "Константин",
    "Леонид",
    "Сергей",
    "Олег",
    "Никита",
    "Назар",
    "Павел",
    "Петр",
    "Тимур",
    "Роберт",
    "Юрий",
    "Эдуард",
    "Эдуард Зыков",
    "Роман",
    "Руслан",
  ];

  const ProductsForWomen = [
    {
      name: "Летающую фею",
      link: "fairy.shopping-market.space",
    },
    {
      name: "Машинка трансформер на радиоуправлении",
      link: "kids-toys.shopping-market.space",
    },
    {
      name: "Набор для рисования светом",
      link: "svet.shopping-market.space",
    },
    {
      name: "Светящееся машинки с трассой",
      link: "magic-tracks.shopping-market.space",
    },
    /* {
      name: "щётку для удаления катышек clothes shaver",
      link: "clothes-shaver.shopping-market.space",
    },
    {
      name: "Силиконовые увлажняющие носочки против трения стопы",
      link: "sani-sticks.shopping-market.space",
    },
    {
      name: "универсальные палочки от засоров sani-sticks",
      link: "sani-sticks.shopping-market.space",
    },
    {
      name: "Чистящее средство для вашей стиральной машинки!",
      link: "magic-wash.shopping-market.space",
    }, */
  ];

  const ProductsForMen = [
    {
      name: "Летающую фею",
      link: "fairy.shopping-market.space",
    },
    {
      name: "Машинка трансформер на радиоуправлении",
      link: "kids-toys.shopping-market.space",
    },
    {
      name: "Набор для рисования светом",
      link: "svet.shopping-market.space",
    },
    {
      name: "Cкребок для автомобиля",
      link: "ice-scrapper.shopping-market.space",
    },
    {
      name: "Светящееся машинки с трассой",
      link: "magic-tracks.shopping-market.space",
    },
    /* {
      name: "щётку для удаления катышек clothes shaver",
      link: "clothes-shaver.shopping-market.space",
    },
    {
      name: "универсальные палочки от засоров sani-sticks",
      link: "sani-sticks.shopping-market.space",
    },
    {
      name: "Чистящее средство для вашей стиральной машинки!",
      link: "magic-wash.shopping-market.space",
    }, */
  ];

  function operationWithItem(sex, arrayOfNames, arrayProducts) {
    const date = new Date();
    const Product =
      arrayProducts[Math.floor(Math.random() * arrayProducts.length)];

    $(`${sex} .buyer__wrapper__content__name`).text(
      `Имя: ${arrayOfNames[Math.floor(Math.random() * arrayOfNames.length)]}`
    );
    $(`${sex} .buyer__wrapper__content__text`).html(
      `Заказал(а) <a class="link" target="_blank" href="https://${Product.link}">${Product.name}</a>`
    );
    $(`${sex} .buyer__wrapper__content__time`).text(
      `Время: ${date.getHours()}:${
        date.getMinutes() <= 9 ? "0" + date.getMinutes() : date.getMinutes()
      }`
    );
    $(`${sex} .buyer__wrapper__content__date`).text(
      `Дата: ${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`
    );
    $(`${sex}`).fadeIn("slow");
    setTimeout(() => {
      $(`${sex}`).fadeOut("slow");
    }, 7000);
  }

  function fadeItem() {
    const ManOrWomen = Math.random().toFixed(2);

    if (ManOrWomen >= 0.18) {
      return operationWithItem(".buyer", NamesWomen, ProductsForWomen);
    } else {
      return operationWithItem(".buyer", NamesMans, ProductsForMen);
    }
  }

  // Время через сколько высветится впервые
  let delay = Math.round(Math.random() * 4 + 4) * 1000;
  // let delay = 500;
  function runBuyers() {
    fadeItem();

    // Время через сколько высветится следующая
    delay = Math.round(Math.random() * 30 + 10) * 1000;
    setTimeout(() => {
      runBuyers();
    }, delay);
  }

  setTimeout(() => {
    runBuyers();
  }, delay);

  // Buyers close
  $(".buyer__wrapper__close").on("click", function () {
    $(".buyer").fadeOut("slow");
  });

  // Filter
  $("[data-filter]").on("click", function (event) {
    event.preventDefault();

    let cat = $(this).data("filter");

    function filersForEach(el) {
      return $(el).each(function () {
        cat == $(this).data("filter")
          ? $(this).addClass("active")
          : $(this).removeClass("active");
      });
    }

    filersForEach(".footer__content__catalog > a");
    filersForEach(".catigories__slider > .slick-list > .slick-track > a");

    if (cat == "Все-товары") {
      $(".catalog__items > [data-category]").css({ display: "inline-block" });
      $(".no-products").css({ display: "none" });
    } else {
      $(".catalog__items > [data-category]").each(function () {
        let workCat = $(this).data("category");

        if (workCat == cat) {
          $(this).data(["category"]).css({ display: "inline-block" });
          $(".no-products").css({ display: "none" });
        } else {
          $(this).data(["category"]).css({ display: "none" });

          let countUnVisableblock = 0;
          $(".catalog__items > .catalog__items__item").each(function () {
            if (
              $(this).css("display") == "none" ||
              $(this).css("visibility") == "hidden"
            ) {
              countUnVisableblock++;
            }
          });

          if (countUnVisableblock == $(".catalog__items > .catalog__items__item").length) {
            $(".no-products").css({ display: "flex" });
          } else {
            $(".no-products").css({ display: "none" });
          }
        }
      });
    }
  });

  // burger
  function toogleBurger(id) {
    const btn = document.querySelector(".header-btn");
    const nav = document.querySelector(".burger-nav");

    document.getElementById(id).addEventListener("click", function () {
      btn.classList.toggle("open");
      nav.classList.toggle("open");
    });
  }
  toogleBurger("header-btn");
  toogleBurger("nav-link-1");
  toogleBurger("nav-link-2");
  toogleBurger("nav-link-3");

  // SendMessage Consultation
  $("#order-form").submit(function (e) {
    e.preventDefault();
    if (
      $("#phone-consult-field").val().length >= 10 &&
      $("#name-consult-field").val().length > 0 &&
      $("#question-consult-field").val().length > 0
    ) {
      $.ajax({
        type: "POST",
        url: "php/telegram.php",
        data: $(this).serialize(),
      }).done(function () {
        //  очищение формы
        $(this).find("input").val("");
        $("#form").fadeOut("slow");
        $("#thanks").fadeIn("slow");
        $("form").trigger("reset");
      });
      return false;
    } else {
      $(".error.name").css({ display: "none" });
      $(".error.phone").css({ display: "none" });
      $(".error.question").css({ display: "none" });

      if (
        $("input[name=phone]").val().length < 10 &&
        $("input[name=name]").val().length == 0 &&
        $("textarea[name=question]").val().length == 0
      ) {
        // все
        $(".error.name").css({ display: "block" });
        $(".error.phone").css({ display: "block" });
        $(".error.question").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length < 10 &&
        $("input[name=name]").val().length > 0 &&
        $("textarea[name=question]").val().length > 0
      ) {
        // телефон
        $(".error.phone").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length >= 10 &&
        $("input[name=name]").val().length == 0 &&
        $("textarea[name=question]").val().length > 0
      ) {
        // имя
        $(".error.name").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length >= 10 &&
        $("input[name=name]").val().length > 0 &&
        $("textarea[name=question]").val().length == 0
      ) {
        // вопрос
        $(".error.question").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length >= 10 &&
        $("input[name=name]").val().length == 0 &&
        $("textarea[name=question]").val().length == 0
      ) {
        // вопрос и имя
        $(".error.name").css({ display: "block" });
        $(".error.question").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length < 10 &&
        $("input[name=name]").val().length == 0 &&
        $("textarea[name=question]").val().length > 0
      ) {
        // телефон и имя
        $(".error.name").css({ display: "block" });
        $(".error.phone").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length < 10 &&
        $("input[name=name]").val().length > 0 &&
        $("textarea[name=question]").val().length == 0
      ) {
        // телефон и вопрос
        $(".error.phone").css({ display: "block" });
        $(".error.question").css({ display: "block" });
      }
    }
  });


  // modal callBack
  document.getElementById("callBack").addEventListener("click", () => {
    $(".overlay, #form").fadeIn("slow");
    $("body").css({ overflow: "hidden" });
  });

  // Modals close
  $("#close-form").on("click", function () {
    $("body").css({ overflow: "auto", "overflow-x": "hidden" });
    $(".overlay, #form").fadeOut("slow");
    console.log(1);
  });

  $("#close-adress-form").on("click", function () {
    $("body").css({ overflow: "auto", "overflow-x": "hidden" });
    $(".overlay, #modal-adress-forms").fadeOut("slow");
  });

  $("#close-thanks").on("click", function () {
    $("body").css({ overflow: "auto", "overflow-x": "hidden" });
    $(".overlay, #thanks").fadeOut("slow");
  });

  $("#close-cart").on("click", function () {
    $("body").css({ overflow: "auto", "overflow-x": "hidden" });
    $(".overlay, #cart").fadeOut("slow");
  });

  // Если нажать ESC закроется модальное окно
  $(document).keyup(function (e) {
    if (e.key === "Escape") {
      $("body").css({ overflow: "auto", "overflow-x": "hidden" });
      $(".overlay, #thanks").fadeOut("slow");
      $(".overlay, #modal-adress-forms").fadeOut("slow");
      $(".overlay, #form").fadeOut("slow");
      $(".overlay, #cart").fadeOut("slow");
    }
  });


  // cart
  let cart = [];
  // Переобразуем массив "cart" в Ассоциативный массив
  let cartAssArr = {};
  function cartAssArrFunction() {
    let cartAssArr = {};
    cart.forEach(function (e) {
      cartAssArr[e.dataId] = e;
    });


    let commonPrice = 0;
    cart.forEach(e => commonPrice = commonPrice + e.totalPrice);

    let stringCartForInput = '';
    for (let i = 0; i < cart.length; i++) {
      stringCartForInput =  stringCartForInput + '     ' + cart[i].namedProduct + ' - ' + cart[i].count + ' шт.  (' + cart[i].totalPrice + ' UAH)%0A';
      // где %0A - перенос строки в телеграмме
    };

    stringCartForInput  =  stringCartForInput + '<b>Общая сумма:</b> ' + commonPrice + ' UAH';
    // console.log(stringCartForInput);
    
    let outCart = '';
    if(cart.length == 0) {
      $('.modal-cart__items__cart-empty').css({ "display": "flex" });
      $('.modal-cart__items__to-order-form').css({ "display": "none" });
      $('.modal-cart__items__total-price').css({ "display": "none" });
    } else {
      $('.modal-cart__items__cart-empty').css({ "display": "none" });
      $('.modal-cart__items__total-price').css({ "display": "block" });
      $('.modal-cart__items__to-order-form').css({ "display": "block" });
      for(let key in cartAssArr) {
        outCart += `<div class="modal-cart__items__products__product"><div class="modal-cart__items__products__product__img-and-title">`;
        outCart += `<img class="modal-cart__items__products__product__img-and-title__img" src=${cartAssArr[key].imgJpgPrew} alt="img">`;
        outCart += `<div class="modal-cart__items__products__product__img-and-title__title">${cartAssArr[key].title}</div></div>`;
        outCart += `<div class="modal-cart__items__products__product__counts-and-price">`;
        outCart += `<button class="modal-cart__items__products__product__counts-and-price__delete" data-delete=${cartAssArr[key].dataId}><img src="icons/garbage-can.svg" alt="img" data-delete=${cartAssArr[key].dataId}></button>`;
        
        outCart += `<div class="modal-cart__items__products__product__counts-and-price__counts">`;
        outCart += `<button class="modal-cart__items__products__product__counts-and-price__counts__button minus" data-counts=${cartAssArr[key].dataId}><img class="minus" src="icons/minus.svg" alt="img" data-counts=${cartAssArr[key].dataId}></button>`;
        outCart += `<div class="modal-cart__items__products__product__counts-and-price__counts__input">${cartAssArr[key].count}</div>`;
        outCart += `<button class="modal-cart__items__products__product__counts-and-price__counts__button plus" data-counts=${cartAssArr[key].dataId}><img class="plus" src="icons/add.svg" alt="img" data-counts=${cartAssArr[key].dataId}></button></div>`;
        outCart += `<div class="modal-cart__items__products__product__counts-and-price__price">${cartAssArr[key].totalPrice} &#8372;</div></div></div>`;
      }
    }



    $('#products').val(stringCartForInput);
    
    $('#products-counts-in-cart, #products-counts-in-cart-mobile').text(cart.length);

    document.getElementById('cart-products').innerHTML = outCart;
    return;
  }
  cartAssArrFunction();

  const totalModalPrice = () => {
    let totalPrice = 0;
    cart.forEach(e => totalPrice = totalPrice + (e.count * e.price));

    $("#total-price").text(totalPrice);
  };

  $("#nav-cart, #nav-cart-mobile").click(function() {
    $("body").css({ overflow: "hidden" });
    $(".overlay, #cart").fadeIn("slow");

    let totalPrice = 0;
    cart.forEach(e => totalPrice = totalPrice + (e.count * e.price));

    $("#total-price").text(totalPrice);
  });

  $("#to-form-window").click(function() {
    $("#cart").fadeOut();
    $("#modal-adress-forms").fadeIn();
  });

  // function plusFunction(e) {
  //   cart[e.count]++;

  //   cartAssArrFunction();
  // }

  // function minusFunction(e) {
  //   if(cart[e.count]-1 == 0) {
  //     cart[e.count] = 0;

  //     cartAssArrFunction();
      
  //     return;
  //   }
  //   cart[e.count]--;

  //   cartAssArrFunction();
  // }

  document.onclick = (el) => {
    if (el.target.hasAttribute("data-id")) {
      if (
        cart.findIndex((e) => String(e.dataId) == String(el.target.dataset.id)) == -1 
      ) {
        
        // Добавление в карзину
        cart.push(catalog.find((e) => e.dataId == el.target.dataset.id));

        $(`[data-id="${el.target.dataset.id}"] img`).attr(
          "src",
          "icons/shopping-cart-added.svg"
        );
        $(
          `.catalog__items__item__content__cart__text[data-id="${el.target.dataset.id}"]`
        ).text("Удалить с корзины");
        cartAssArrFunction();   

        return true;
      } else if (
        cart.findIndex((e) => String(e.dataId) == String(el.target.dataset.id)) > -1 
      ) {
        // Удаление с корзины
        const findIndexInChooseItems = cart.findIndex(
          (e) => e.dataId == el.target.dataset.id
        );
        cart = [
          ...cart.slice(0, findIndexInChooseItems),
          ...cart.slice(findIndexInChooseItems + 1),
        ];

        $(`[data-id="${el.target.dataset.id}"] img`).attr(
          "src",
          "icons/shopping-cart.svg"
        );
        $(
          `.catalog__items__item__content__cart__text[data-id="${el.target.dataset.id}"]`
        ).text("Добавить в корзину");
        cartAssArrFunction();

        return true;
      } else {
        return false;
      }
    } else if (el.target.classList.contains('plus')) {
      const findIndexInChooseItems = cart.findIndex( item => item.dataId === el.target.dataset.counts);
      if (findIndexInChooseItems >= 0) {
          
          let Elem = cart[findIndexInChooseItems];
          let newElem = {
              ...Elem,
              count: ++Elem.count,
              totalPrice: Elem.price * Elem.count
          }

          cart = [
            ...cart.slice(0, findIndexInChooseItems),
            newElem,
            ...cart.slice(findIndexInChooseItems + 1),
          ];


          totalModalPrice();
          cartAssArrFunction();
      };
      
      // plusFunction();
    } else if (el.target.classList.contains('minus')) {
      const findIndexInChooseItems = cart.findIndex( item => item.dataId === el.target.dataset.counts);
      if (findIndexInChooseItems >= 0) {
          
          let Elem = cart[findIndexInChooseItems];

          if (Elem.count > 0) {
            let newElem = {
              ...Elem,
              count: --Elem.count,
              totalPrice: Elem.price * Elem.count,
            };

            cart = [
              ...cart.slice(0, findIndexInChooseItems),
              newElem,
              ...cart.slice(findIndexInChooseItems + 1),
            ];

            totalModalPrice();
            cartAssArrFunction();
          }
        }
    } else if (el.target.hasAttribute("data-delete")) {
      const findIndexInItemsCard = cart.findIndex( item => item.dataId == el.target.dataset.delete);
      cart = [
        ...cart.slice(0, findIndexInItemsCard),
        ...cart.slice(findIndexInItemsCard + 1)
      ];
      $(`[data-id="${el.target.dataset.delete}"] img`).attr(
        "src",
        "icons/shopping-cart.svg"
      );
      $(
        `.catalog__items__item__content__cart__text[data-id="${el.target.dataset.delete}"]`
      ).text("Добавить в корзину");
      totalModalPrice();
    };
    
    cartAssArrFunction();
  };

  // SendMessage
  $("#adress-form").submit(function (e) {
    e.preventDefault();
    if (
      $("input[name=phone]").val().length >= 10 &&
      $("input[name=name]").val().length > 0
    ) {
      $.ajax({
        type: "POST",
        url: "php/request-cart.php",
        data: $(this).serialize(),
      }).done(function () {
        $(".error.name").css({ display: "none" });
        $(".error.phone").css({ display: "none" });

        //  очищение формы
        $(this).find("input").val("");
        $("#modal-adress-forms").fadeOut("slow");
        $("#thanks").fadeIn("slow");
        $("form").trigger("reset");
      });
      return false;
    } {
      $(".error.name").css({ display: "none" });
      $(".error.phone").css({ display: "none" });

      if (
        $("input[name=phone]").val().length < 10 &&
        $("input[name=name]").val().length == 0
      ) {
        // все
        $(".error.name").css({ display: "block" });
        $(".error.phone").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length < 10 &&
        $("input[name=name]").val().length > 0
      ) {
        // телефон
        $(".error.phone").css({ display: "block" });
      } else if (
        $("input[name=phone]").val().length >= 10 &&
        $("input[name=name]").val().length == 0
      ) {
        // имя
        $(".error.name").css({ display: "block" });
      }; 
    }
  });
  
});

